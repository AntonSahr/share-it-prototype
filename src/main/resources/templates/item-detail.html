<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="de">
<head>
    <meta charset="UTF-8"/>
    <title th:text="'Detailansicht: ' + ${item.title}">Detailansicht: Item</title>
    <link rel="stylesheet" th:href="@{/css/main.css}" />

    <!-- Leaflet CSS -->
    <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
</head>
<body>

<!-- === Header / Topbar === -->
<header class="header-container">
    <div class="header-inner">
        <h1 class="site-title"><a th:href="@{/}">ShareIt</a></h1>
        <nav class="main-nav">
            <a th:href="@{/}">Startseite</a>
            <a th:href="@{/items}">Angebote</a>
            <a th:href="@{/items/new}">Neues Item</a>
            <a th:href="@{/profile}">Profil</a>
            <a th:href="@{/logout}">Abmelden</a>
        </nav>
    </div>
</header>

<!-- === Hauptinhalt === -->
<main class="content-container">
    <div class="content-box">
        <h2 th:text="'Detailansicht: ' + ${item.title}">Detailansicht: Titel</h2>

        <!-- Titel des Items -->
        <div>
            <div class="field-label">Titel:</div>
            <div class="field-value" th:text="${item.title}">Beispiel-Titel</div>
        </div>

        <!-- Beschreibung -->
        <div th:if="${item.description != null}">
            <div class="field-label">Beschreibung:</div>
            <div class="field-value" th:text="${item.description}">Beispiel-Beschreibung</div>
        </div>

        <!-- Preiseinheit und Betrag -->
        <div>
            <span class="field-label">Preis:</span>
            <span class="field-value">
                <span th:text="${item.priceAmount}">0.00</span>
                <span th:text="${item.priceUnit.name().toLowerCase()}">daily</span>
            </span>
        </div>

        <!-- Eigentümer-Info -->
        <div>
            <div class="field-label">Anbieter:</div>
            <div class="field-value"
                 th:text="${item.ownerDisplayName} + ' (ID: ' + ${item.ownerId} + ')'">
                Max Mustermann (ID: 1)
            </div>
        </div>

        <!-- Adresse (nur anzeigen, wenn nicht-leer) -->
        <div th:if="${item.address != null and item.address != ''}">
            <div class="field-label">Adresse:</div>
            <div class="field-value" th:text="${item.address}">Musterstraße 1, 12345 Berlin</div>
        </div>

        <!-- Koordinaten -->
        <div th:if="${item.latitude != null and item.longitude != null}">
            <div class="field-label">Koordinaten (Lat, Lon):</div>
            <div class="field-value"
                 th:text="${item.latitude} + ', ' + ${item.longitude}">
                52.521918, 13.413215
            </div>
        </div>

        <!-- Erstellungs- und Aktualisierungszeitpunkt -->
        <div>
            <div class="field-label">Erstellt am:</div>
            <div class="field-value"
                 th:text="${#temporals.format(item.createdAt, 'yyyy-MM-dd HH:mm')}">
                2025-06-02 14:30
            </div>
        </div>
        <div>
            <div class="field-label">Zuletzt aktualisiert:</div>
            <div class="field-value"
                 th:text="${#temporals.format(item.updatedAt, 'yyyy-MM-dd HH:mm')}">
                2025-06-10 09:15
            </div>
        </div>

        <!-- Leaflet-Karte nur anzeigen, wenn Koordinaten vorhanden sind -->
        <div th:if="${item.latitude != null and item.longitude != null}">
            <div id="detail-map" style="height: 300px;"></div>
        </div>
        <div th:if="${item.latitude == null or item.longitude == null}" class="no-location">
            Keine Standortdaten verfügbar.
        </div>

        <!-- Aktionen: Bearbeiten / Löschen / Zurück -->
        <div class="actions" style="margin-top: 1.5rem;">
            <a th:href="@{/items/{id}/edit(id=${item.id})}" class="button button-secondary">Bearbeiten</a>
            <form th:action="@{/items/{id}/delete(id=${item.id})}" method="post" style="display:inline; margin-left: 1rem;">
                <!-- CSRF-Token wird automatisch ergänzt -->
                <button type="submit" class="button delete"
                        onclick="return confirm('Item wirklich löschen?');">
                    Löschen
                </button>
            </form>
            <a th:href="@{/items}" class="button button-secondary" style="margin-left: 1rem;">Zurück zur Übersicht</a>
        </div>
    </div>
</main>

<!-- === Footer === -->
<footer class="footer-container">
    <div class="footer-inner">
        <p>&copy; 2025 ShareIt</p>
    </div>
</footer>

<!-- === Leaflet JS === -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    // Prüfen, ob Koordinaten vorhanden sind
    var lat = [[${item.latitude}]];     // → JavaScript-Literal oder null
    var lon = [[${item.longitude}]];    // → JavaScript-Literal oder null

    if (lat != null && lon != null) {
        // Karte initialisieren
        var map = L.map('detail-map').setView([lat, lon], 14);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Marker auf item's Koordinate setzen
        L.marker([lat, lon]).addTo(map)
            .bindPopup(/*[[${item.title}]]*/ "Titel")
            .openPopup();
    }
    /*]]>*/
</script>

</body>
</html>
